CREATE TABLE IF NOT EXISTS users (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    NAME VARCHAR(64) NOT NULL ,
    EMAIL VARCHAR(64) NOT NULL UNIQUE ,
    CONSTRAINT PK_USERS PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS categories (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    NAME VARCHAR(64) NOT NULL ,
    CONSTRAINT UN_CAT_NAME UNIQUE (NAME),
    CONSTRAINT PK_CATEGORIES PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS locations (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    LAT REAL NOT NULL ,
    LON REAL NOT NULL ,
    CONSTRAINT PK_LOCATION PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS events (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    TITLE VARCHAR(255) NOT NULL ,
    DESCRIPTION TEXT NOT NULL ,
    ANNOTATION TEXT NOT NULL ,
    CATEGORY_ID BIGINT ,
    EVENT_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL ,
    PUBLISHED_ON TIMESTAMP WITHOUT TIME ZONE ,
    CREATED_ON TIMESTAMP WITHOUT TIME ZONE ,
    LOCATION_ID BIGINT NOT NULL ,
    INITIATOR_ID BIGINT NOT NULL ,
    PAID BOOLEAN NOT NULL ,
    PARTICIPANT_LIMIT BIGINT NOT NULL ,
    STATE VARCHAR(255),
    CONSTRAINT PK_EVENTS PRIMARY KEY (ID) ,
    CONSTRAINT FK_EVENTS_USERS FOREIGN KEY (INITIATOR_ID) REFERENCES users (ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FK_EVENTS_CATEGORY FOREIGN KEY (CATEGORY_ID) REFERENCES categories (ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FK_EVENTS_LOCATION FOREIGN KEY (LOCATION_ID) REFERENCES locations (ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS compilations (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PINNED BOOLEAN,
    TITLE VARCHAR(128),
    CONSTRAINT PK_COMP PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS compilations_events (
    COMPILATION_ID BIGINT NOT NULL ,
    EVENT_ID BIGINT NOT NULL ,
    CONSTRAINT PK_COMP_EVENTS PRIMARY KEY (COMPILATION_ID, EVENT_ID) ,
    CONSTRAINT FK_COMPILATION FOREIGN KEY (COMPILATION_ID) REFERENCES compilations (ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FK_EVENTS FOREIGN KEY (EVENT_ID) REFERENCES events (ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS requests (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    EVENT_ID BIGINT NOT NULL ,
    REQUESTER_ID BIGINT NOT NULL ,
    CREATED TIMESTAMP WITHOUT TIME ZONE ,
    STATUS VARCHAR(64) ,
    CONSTRAINT PK_REQ PRIMARY KEY (ID) ,
    CONSTRAINT UN_REQUESTS UNIQUE (EVENT_ID, REQUESTER_ID),
    CONSTRAINT FK_REQ_EVENTS FOREIGN KEY (EVENT_ID) REFERENCES events (ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FK_REQ_USERS FOREIGN KEY (REQUESTER_ID) REFERENCES users (ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS comments (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL ,
    EVENT_ID BIGINT NOT NULL ,
    COMMENTATOR_ID BIGINT NOT NULL ,
    ANNOTATION VARCHAR(255) ,
    TEXT TEXT NOT NULL ,
    MODIFIED TIMESTAMP WITHOUT TIME ZONE ,
    CREATED TIMESTAMP WITHOUT TIME ZONE ,
    STATUS VARCHAR(64),
    CONSTRAINT PK_COMMENTS PRIMARY KEY (ID),
    CONSTRAINT FK_COMMENTS_EVENTS FOREIGN KEY (EVENT_ID) REFERENCES events (ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FK_COMMENTS_USERS FOREIGN KEY (COMMENTATOR_ID) REFERENCES users (ID) ON DELETE CASCADE ON UPDATE CASCADE
);